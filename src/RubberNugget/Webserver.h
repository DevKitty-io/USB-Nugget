#include "Arduino.h"

String runHtml = "<!DOCTYPE html><head> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/> <meta charset=\"UTF-8\"> <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\"></head><body onload=\"loadPayloadTables()\"> <script src=\"run.js\"> </script> <div class=\"statusText\"></div><nav> <div class=\"container\"> <a href=\"run.html\">Run</a> <a href=\"create.html\">Create</a> </div></nav> <div class=\"container\" style=\"margin-top: 5em\"> <div class=\"payloadTable\"> <h2>Starred</h2> <table> <tbody id=\"tableStarred\"> </tbody> </table> <div id=\"editStarred\"> </div></div><div class=\"payloadTable\"> <h2>Linux</h2> <table> <thead> </thead> <tbody id=\"tableLinux\"> </tbody> </table> <div id=\"editLinux\"> </div></div><div class=\"payloadTable\"> <h2>Mac</h2> <table> <thead> </thead> <tbody id=\"tableMac\"> </tbody> </table> <div id=\"editMac\"> </div></div><div class=\"payloadTable\"> <h2>Windows</h2> <table> <thead> </thead> <tbody id=\"tableWindows\"> </tbody> </table> <div id=\"editWindows\"> </div></div><div style=\"text-align: center; margin-top: 10em\"> <p><b>Copyright 2022, HakCat Hardware</b></p><p>Beta v1.0.4</p></div></div></body></html>";

String runJs = "function loadPayloadTables() {\r\n    console.log(\"Loading payloads...\");\r\n\r\n    const xhttp = new XMLHttpRequest();\r\n    xhttp.open(\"GET\", \"/data.json?rand=\" + Date.now(), false); // prove endpoint to return json\r\n    xhttp.send(null);\r\n\r\n    var json = xhttp.responseText;\r\n    const obj = JSON.parse(json);\r\n    const pTables = [\"tableStarred\", \"tableLinux\", \"tableMac\", \"tableWindows\"];\r\n    const pTypes = [\"Starred\", \"Linux\", \"Mac\", \"Windows\"];\r\n    const pEditOs = [\"editStarred\", \"editLinux\", \"editMac\", \"editWindows\"];\r\n\r\n    // append to each table\r\n    for (let i = 0; i < 4; i++) {\r\n        for (let j = 0; j < Object.keys(obj).length; j++) {\r\n            try {\r\n                var payload = obj[j];\r\n                if (payload.pOS.toUpperCase() == pTypes[i].toUpperCase()) {\r\n                    const table = document.createElement(\"tr\");\r\n                    const payloadName = document.createElement(\"td\"); payloadName.innerText = payload.pName; payloadName.classList.add(\"payloadname\");\r\n                    const payloadEdit = document.createElement(\"td\"); payloadEdit.innerHTML = \"<button class=\\\"edit\\\" onclick=\\\"editPayload(\\\'/\"+pTypes[i]+\"/\"+ payload.pCategory + \"/\" + payload.pName + \"\\\',\\\'\" + pEditOs[i] + \"\')\\\">Edit</button>\";\r\n                    const payloadRun = document.createElement(\"td\"); payloadRun.innerHTML = \"<button class=\\\"run\\\" onclick=\\\"runPayload(\'\"+pEditOs[i]+\"\',\\\'/\"+pTypes[i]+\"/\" + payload.pCategory + \"/\" + payload.pName + \"\\\')\\\">Run</button>\";\r\n                    \r\n                    table.appendChild(payloadName);\r\n                    table.appendChild(payloadEdit);\r\n                    table.appendChild(payloadRun);\r\n\r\n                    document.getElementById(pTables[i]).appendChild(table);\r\n                }\r\n            }\r\n            catch (error) {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// run payload with path on internal server\r\nfunction runPayload(payloadEdit, payloadPath) {\r\n    closeEdit();\r\n\r\n    var editArea = document.getElementById(payloadEdit);\r\n    editArea.innerHTML = \"<p id=\\\"statusText\\\">Running: <b>\" + payloadPath + \"</b></p>\";\r\n    \r\n    var xmlHttp = new XMLHttpRequest();\r\n    xmlHttp.open(\"GET\", \"runpayload.php?path=\"+payloadPath, false); // false for synchronous request\r\n    xmlHttp.send(null);\r\n    return xmlHttp.responseText;\r\n}\r\n\r\nfunction editPayload(payloadPath, payloadEdit) {\r\n    closeEdit();\r\n    var editArea = document.getElementById(payloadEdit);\r\n    var xmlHttp = new XMLHttpRequest();\r\n    xmlHttp.open(\"GET\", \"getpayload.php?path=\"+payloadPath, false); // false for synchronous request\r\n    xmlHttp.send(null);\r\n\r\n    editArea.innerHTML = \"<p id=\\\"statusText\\\">Editing: <b>\" + payloadPath + \"</b></p>\\\r\n<div class=\\\"row\\\"> \\\r\n<div class=\\\"input-field col s12\\\"> \\\r\n<textarea id=\\\"textarea1\\\" rows = 10 class=\\\"materialize-textarea\\\">\"+atob(xmlHttp.responseText)+\"\\n</textarea> \\\r\n</div> \\\r\n<button class=\\\"run\\\" onclick=\\\"runLive(\\\'\"+payloadEdit+\"\\\')\\\">Run Live</button> \\\r\n<button class=\\\"edit\\\" onclick=\\\"savePayload(\'\"+payloadEdit+\"\',\'\"+payloadPath+\"\')\\\">Save</button> \\\r\n<button class=\\\"close\\\" onclick=\\\"closeEdit()\\\">Close</button> \\\r\n<button class=\\\"run\\\" onclick=\\\"deletePayload(\'\"+payloadPath+\"\')\\\">Delete</button> \\\r\n</div> \\\r\n\";\r\n}\r\n\r\nfunction closeEdit(payloadEdit) {\r\n    document.getElementById(\"editStarred\").innerHTML = \"\";\r\n    document.getElementById(\"editLinux\").innerHTML = \"\";\r\n    document.getElementById(\"editMac\").innerHTML = \"\";\r\n    document.getElementById(\"editWindows\").innerHTML = \"\";\r\n}\r\n\r\n// take encode\r\n\r\nfunction runLive(payloadEdit) {\r\n    document.getElementById(\"statusText\").innerHTML=\"<p><b>Running Live!</b></p>\";\r\n    var editArea = document.getElementById(textarea1);\r\n\r\n    var xmlHttp = new XMLHttpRequest();\r\n    xmlHttp.open(\"POST\", \"runlive.php\");\r\n    xmlHttp.setRequestHeader(\"Content-Type\", \"plain/text\");\r\n    xmlHttp.send(btoa(document.getElementById(\"textarea1\").value));\r\n\r\n}\r\n\r\n// merge into single function? ugh\r\nfunction savePayload(payloadEdit, payloadPath) {\r\n    document.getElementById(\"statusText\").innerHTML=\"<p>Saved: <b>\"+payloadPath+\"</b></p>\";\r\n    var editArea = document.getElementById(textarea1);\r\n\r\n    // encode base64 and send \r\n    var xmlHttp = new XMLHttpRequest();\r\n    xmlHttp.open(\"POST\", \"savepayload.php\");\r\n    xmlHttp.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n    xmlHttp.send(\"path=\"+payloadPath+\"&content=\"+btoa(textarea1.value));\r\n}\r\n\r\nfunction deletePayload(payloadPath) {\r\n    var xmlHttp = new XMLHttpRequest();\r\n    xmlHttp.open(\"POST\", \"deletepayload.php\");\r\n    xmlHttp.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n    xmlHttp.send(\"path=\"+payloadPath);\r\n\r\n    setTimeout( function () { location.reload(); }, 2000 );\r\n}\r\n\r\nfunction saveNew() {\r\n    var payloadname = document.getElementById(\"pnamec\").value;\r\n    var payloadcat = document.getElementById(\"pcatc\").value;\r\n    var payloados = document.getElementById(\"osc\").value;\r\n\r\n    if (payloadname != \"\" && payloadcat != \"\") {\r\n        var newpath = \"/\"+payloados+\"/\"+payloadcat+\"/\"+payloadname;\r\n        document.getElementById(\"statusText\").innerHTML=\"<p>Saved: <b>\"+newpath+\"</b></p>\";\r\n    }\r\n    else {\r\n        document.getElementById(\"statusText\").innerHTML=\"<p>Can\'t save payload!  Please check the name & category fields.</p>\";\r\n    }\r\n\r\n    savePayload(\"lolz\", newpath);\r\n    \r\n}";

String runCss ="*{font-family: sans-serif;}.container{width: 70%; margin: auto; /* margin-top: 5em; */}table{width: 100%; padding: .7em;}tr{text-align: left;}td{padding: .3em;}.payloadTable{margin-bottom: 4em;}button{border: none; padding: .8em; border-radius: 3px;}.run{background-color: #ef5350; color: white;}.run:hover{background-color: #e57373;}.edit{background-color: #66bb6a73; color: white;}.edit:hover{background-color: #8abe8d91;}.close{background-color: #3949ab; color: white;}.close:hover{background-color: #4d5aaf;}textarea{display: block; width: 100%; max-width:100%; min-width: 100%; margin-bottom: 1em; background-color: #263238; color: white; padding: .7em; box-sizing: border-box;}nav{max-width: 100%; background-color: #263238;}table, textarea, input, select{border-radius: 5px; background-color: #263238; border: 1px solid #25282c; color: white;}nav a{display: inline-block; padding: .9em; color: #e4e4e4; text-decoration: none;}nav a:hover{background-color: #222529; cursor: pointer;}td{width: 200px !important;}body{margin: 0; background-color: #36393e; color: #e4e4e4;}.payloadname{width: 300px !important;}#editStarred, #editLinux, #editWindows, #editMac{margin-top: 2em;}@media only screen and (max-width: 700px){.container{width: 90% !important;}}input{width: 100%; box-sizing: border-box; padding: 10px; margin-bottom: 20px;}select{padding: 10px;}";

String createHtml = "<!DOCTYPE html><head> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/> <meta charset=\"UTF-8\"> <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\"></head><body onload=\"loadPayloadTables()\"> <script src=\"run.js\"> </script> <div class=\"status\"></div><nav> <div class=\"container\"> <a href=\"run.html\">Run</a> <a href=\"create.html\">Create</a> </div></nav> <div class=\"container\" style=\"margin-top: 5em\"> <div class=\"payloadTable\"> <h2>Create a payload</h2> <div> <input type=\"text\" id=\"pnamec\" name=\"fname\" placeholder=\"Payload Name\"> <input type=\"text\" id=\"pcatc\" name=\"lname\" placeholder=\"Payload Category\"> <div style=\"margin-bottom:20px;\"> <label for=\"os\">OS:</label> <select name=\"os\" id=\"osc\"> <option value=\"Linux\">Linux</option> <option value=\"Mac\">Mac</option> <option value=\"Windows\">Windows</option> <option value=\"Starred\">Starred</option> </select> </div></div><textarea id=\"textarea1\" name=\"w3review\" rows=\"10\" placeholder=\"Start writing payload here!\"></textarea> <p id=\"statusText\"></p><span> <button class=\"edit\" onclick=\"saveNew()\">Save</button> <button class=\"run\" onclick=\"runLive()\">Run Live</button> </span> </div><div style=\"text-align: center; margin-top: 10em\"> <p><b>Copyright 2022, HakCat Hardware</b></p><p>Beta v1.0.4</p></div></div><script src=\"run.js\"></script></body></html>";
